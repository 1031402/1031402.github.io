<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Mul.Live ì‹¤í–‰ ë„ìš°ë¯¸</title>
  <!-- ê²€ìƒ‰ì—”ì§„ ì°¨ë‹¨ -->
  <meta name="robots" content="noindex, nofollow">
  <style>
    body { background:#111; color:#fff; font-family:sans-serif; padding:20px; }
    h2 { margin-bottom:20px; }
    .section { margin-bottom:20px; }
    input {
      width:500px;
      padding:6px;
      margin:5px 0;
      display:block;
    }
    button {
      padding:6px 12px;
      margin-top:10px;
      cursor:pointer;
      font-size:14px;
    }
    .list { margin-top:10px; }
  </style>
</head>
<body>
  <h2>ğŸš€ Mul.Live ìë™ ì‹¤í–‰ ë„ìš°ë¯¸</h2>

  <!-- SOOP -->
  <div class="section">
    <h3>SOOP ë°©ì†¡ (BJ ì´ë¦„ ë˜ëŠ” ì£¼ì†Œ) <span style="color:#f66;">â€» ìµœì†Œ 1ëª…</span></h3>
    <div id="soopList" class="list"></div>
    <button onclick="addSoop()">+ SOOP ì¶”ê°€</button>
  </div>

  <!-- YouTube -->
  <div class="section">
    <h3>YouTube ë°©ì†¡ (ì„ íƒ ì‚¬í•­)</h3>
    <button onclick="openYouTubeSearch()">ğŸ” ìœ íŠœë¸Œ ê²€ìƒ‰í•˜ê¸°</button>
    <input type="text" id="ytInput" placeholder="ì°¾ì€ ìœ íŠœë¸Œ ì£¼ì†Œ ë¶™ì—¬ë„£ê¸° (ë¹„ì›Œë„ ë¨)">
  </div>

  <button onclick="openMul()" style="margin-top:30px;font-size:16px;">ğŸš€ Mul.Live ì—´ê¸°</button>

  <script>
    let soopMap = {};

    // map.json ë¶ˆëŸ¬ì˜¤ê¸°
    fetch("map.json")
      .then(res => res.json())
      .then(data => {
        soopMap = data;
        console.log("ë§µí•‘ ë¡œë“œ ì™„ë£Œ:", soopMap);
      })
      .catch(err => {
        console.error("map.json ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", err);
      });

    // SOOP ì…ë ¥ì¹¸ ì¶”ê°€
    function addSoop(value="") {
      const div = document.createElement("div");
      div.innerHTML = `<input type="text" placeholder="BJ ì´ë¦„ ë˜ëŠ” ë°©ì†¡ ì£¼ì†Œ" value="${value}">`;
      document.getElementById("soopList").appendChild(div);
    }

    // ìœ íŠœë¸Œ ê²€ìƒ‰ ìƒˆì°½ ì—´ê¸°
    function openYouTubeSearch() {
      const query = prompt("ê²€ìƒ‰í•  í‚¤ì›Œë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”:", "");
      if (query) {
        window.open("https://www.youtube.com/results?search_query=" + encodeURIComponent(query), "_blank");
      }
    }

    // ìœ íŠœë¸Œ ID ì¶”ì¶œ
    function getYoutubeId(input) {
      input = input.trim();
      try {
        if (input.includes("youtube.com/watch")) {
          return new URL(input).searchParams.get("v");
        }
        if (input.includes("youtu.be/")) {
          return input.split("youtu.be/")[1].split(/[?&]/)[0];
        }
        return input;
      } catch {
        return input;
      }
    }

    // SOOP ID ì¶”ì¶œ (ì£¼ì†Œ -> ì•„ì´ë”” ë³€í™˜)
    function getSoopId(input) {
      input = input.trim();
      if (soopMap[input]) return soopMap[input]; // ë§¤í•‘ ìš°ì„ 
      if (input.includes("sooplive.co.kr/")) {
        try {
          return new URL(input).pathname.split("/")[1];
        } catch {
          return "";
        }
      }
      return input; // ì§ì ‘ ì•„ì´ë”” ì…ë ¥
    }

    // Mul.Live ì—´ê¸°
    function openMul() {
      const soopInputs = document.querySelectorAll("#soopList input");
      const ytInput = document.getElementById("ytInput").value.trim();

      let parts = [];

      // SOOP ë³€í™˜
      soopInputs.forEach(inp => {
        const name = inp.value.trim();
        if (name) {
          const id = getSoopId(name);
          if (id) {
            parts.push(id);
          } else {
            alert(`SOOP ì•„ì´ë””ë¥¼ ì¸ì‹í•  ìˆ˜ ì—†ìŒ: ${name}`);
          }
        }
      });

      if (parts.length === 0) {
        alert("SOOP BJëŠ” ìµœì†Œ 1ê°œ ì´ìƒ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤!");
        return;
      }

      // ìœ íŠœë¸Œ ì¶”ê°€ (ì„ íƒ)
      if (ytInput) {
        const ytId = getYoutubeId(ytInput);
        parts.push("y:" + ytId);
      }

      const mulUrl = "https://mul.live/" + parts.join("/");
      window.open(mulUrl, "_blank");
    }

    // ê¸°ë³¸ SOOP ì…ë ¥ì¹¸ í•˜ë‚˜ ìƒì„±
    addSoop();
  </script>
</body>
</html>
