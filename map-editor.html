<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>SOOP ë§¤í•‘ ì—ë””í„°</title>
  <style>
    body { background:#111; color:#fff; font-family:sans-serif; padding:20px; }
    h2 { margin-bottom:20px; }
    textarea { width:100%; height:300px; font-family:monospace; padding:10px; }
    button { margin-top:10px; padding:8px 14px; cursor:pointer; font-size:14px; }
  </style>
</head>
<body>
  <h2>ğŸ“ SOOP ë§¤í•‘ ìˆ˜ì •ê¸°</h2>
  <p>ì•„ë˜ JSONì„ ìˆ˜ì • í›„ <b>ì €ì¥</b>ì„ ëˆ„ë¥´ë©´ <code>map.json</code>ì´ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤.</p>

  <textarea id="editor"></textarea>
  <br>
  <button onclick="saveToGitHub()">â˜ GitHubì— ì €ì¥</button>

  <script>
    // ===== GitHub ì„¤ì • =====
    const owner   = "lakeminbab";         // ê¹ƒí—ˆë¸Œ ì•„ì´ë””
    const repo    = "jundori";      // ì €ì¥ì†Œ ì´ë¦„
    const path    = "map.json";        // íŒŒì¼ ê²½ë¡œ
    const branch  = "main";            // ê¸°ë³¸ ë¸Œëœì¹˜
    const token   = "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"; // ë³¸ì¸ Personal Access Token

    // ===== íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸° =====
    async function loadFile() {
      const res = await fetch(`https://raw.githubusercontent.com/${owner}/${repo}/${branch}/${path}`);
      if (res.ok) {
        const text = await res.text();
        document.getElementById("editor").value = text;
      } else {
        alert("âš  map.json ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨");
      }
    }

    // ===== GitHubì— ì €ì¥ =====
    async function saveToGitHub() {
      const content = document.getElementById("editor").value;
      let contentBase64 = btoa(unescape(encodeURIComponent(content)));

      // 1) í˜„ì¬ íŒŒì¼ sha ê°€ì ¸ì˜¤ê¸°
      const metaRes = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${path}?ref=${branch}`, {
        headers: { "Authorization": `token ${token}` }
      });
      const meta = await metaRes.json();
      const sha = meta.sha;

      // 2) íŒŒì¼ ì—…ë°ì´íŠ¸
      const commitMessage = `Update map.json via map-editor (${new Date().toISOString()})`;
      try {
        const putRes = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${path}`, {
          method: "PUT",
          headers: { 
            "Authorization": `token ${token}`,
            "Content-Type":"application/json",
            "Accept":"application/vnd.github+json"
          },
          body: JSON.stringify({
            message: commitMessage,
            content: contentBase64,
            sha: sha,
            branch: branch
          })
        });
        const putData = await putRes.json();
        if (putRes.ok) {
          // ì €ì¥ ì„±ê³µ ì‹œ ì‚¬ìš©ì ì„ íƒ
          const ghPagesUrl = `https://${owner}.github.io/${repo}/index.html`;
          if (confirm("âœ… GitHubì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nğŸ‘‰ index.htmlë¡œ ì´ë™í• ê¹Œìš”?")) {
            location.href = ghPagesUrl;  // í˜„ì¬ ì°½ì—ì„œ index.htmlë¡œ ì´ë™
          } else {
            alert("âœ” ì €ì¥ ì™„ë£Œ! (í˜„ì¬ í˜ì´ì§€ì— ë¨¸ë¬´ë¦…ë‹ˆë‹¤)");
          }
        } else {
          alert("GitHub ì €ì¥ ì‹¤íŒ¨: " + (putData.message || JSON.stringify(putData)));
        }
      } catch (err) {
        alert("GitHub ì €ì¥ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: " + err.message);
      }
    }

    // ì‹¤í–‰ ì‹œ ìë™ ë¶ˆëŸ¬ì˜¤ê¸°
    loadFile();
  </script>
</body>
</html>
